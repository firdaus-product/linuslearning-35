<!DOCTYPE html>
<html lang="ms-MY" class="overflow-hidden overscroll-none">

<head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
   <title>Matematik Ceria: Operasi Tolak (Situasi Harian)</title>
   <script src="https://cdn.tailwindcss.com"></script>
   <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap" rel="stylesheet">
   <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

   <style>
      /* --- UI STYLE (MASTER REFERENCE - TEMA HIJAU) --- */
      body {
         font-family: 'Fredoka', sans-serif;
         background-color: #f0fdf4;
         background-image: radial-gradient(#86efac 2px, transparent 2px);
         background-size: 30px 30px;
      }

      .game-card {
         background: white;
         border: 4px solid #475569;
         box-shadow: 8px 8px 0px #00000020;
         border-radius: 1.5rem;
         /* min-height: 600px; REMOVED */
         position: relative;
         display: flex;
         align-items: center;
         justify-content: center;
         flex-direction: column;
      }

      /* Buttons */
      .btn-3d {
         transition: all 0.1s;
         border-bottom-width: 6px;
         border-color: rgba(0, 0, 0, 0.2);
         transform: translateY(0);
         cursor: pointer;
         display: inline-block;
      }

      .btn-3d:active:not(:disabled) {
         transform: translateY(4px);
         border-bottom-width: 2px;
         box-shadow: none;
      }

      .btn-3d:disabled {
         opacity: 0.6;
         cursor: not-allowed;
         border-bottom-width: 6px;
         filter: grayscale(100%);
      }

      /* Animation */
      .shake {
         animation: shake 0.4s ease-in-out;
         border-color: #ef4444 !important;
         background-color: #fee2e2 !important;
      }

      @keyframes shake {

         0%,
         100% {
            transform: translateX(0);
         }

         25% {
            transform: translateX(-8px) rotate(-5deg);
         }

         75% {
            transform: translateX(8px) rotate(5deg);
         }
      }

      /* --- STYLE KHUSUS SITUASI HARIAN --- */

      /* Drag & Drop */
      .drop-zone {
         border: 3px dashed #94a3b8;
         background-color: #f8fafc;
         transition: all .3s ease;
         border-radius: 0.75rem;
         min-width: 70px;
         min-height: 50px;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         font-weight: bold;
         color: #334155;
      }

      .drop-zone.drag-over {
         border-color: #3b82f6;
         background-color: #dbeafe;
         transform: scale(1.05);
      }

      .drop-zone.filled {
         border: 3px solid #22c55e;
         background-color: #dcfce7;
         color: #15803d;
      }

      .draggable-item {
         cursor: grab;
         user-select: none;
         touch-action: none;
      }

      .draggable-item:active {
         cursor: grabbing;
         opacity: 0.5;
         transform: scale(1.1);
      }

      /* Objek Visual (Bundles & Singles) */
      .obj-bundle {
         background-color: #fbbf24;
         border: 3px solid #f59e0b;
         width: 40px;
         height: 60px;
         border-radius: 8px;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         font-size: 1.2rem;
         font-weight: bold;
         color: #92400e;
         cursor: pointer;
         margin: 2px;
         box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
         transition: transform 0.1s;
      }

      .obj-bundle:hover {
         transform: scale(1.05);
      }

      .obj-single {
         background-color: #34d399;
         border: 3px solid #059669;
         width: 30px;
         height: 30px;
         border-radius: 50%;
         display: inline-flex;
         align-items: center;
         justify-content: center;
         font-size: 0.9rem;
         font-weight: bold;
         color: #064e3b;
         cursor: grab;
         margin: 2px;
      }

      /* Bentuk Lazim Table */
      .lazim-table {
         width: 100%;
         border-collapse: collapse;
         font-size: 1.5rem;
         font-weight: bold;
         text-align: center;
         color: #334155;
      }

      .lazim-table td {
         padding: 5px;
         position: relative;
      }

      .col-pu {
         border-right: 3px solid #cbd5e1;
      }

      .row-line td {
         border-top: 4px solid #475569;
      }

      .strike {
         text-decoration: line-through;
         color: #ef4444;
         opacity: 0.6;
      }

      .borrow-new {
         position: absolute;
         top: -10px;
         left: 50%;
         transform: translateX(-50%);
         font-size: 1rem;
         color: #22c55e;
         background: #dcfce7;
         padding: 1px 4px;
         border-radius: 4px;
         border: 1px solid #22c55e;
         z-index: 10;
      }
   </style>
</head>

<body class="h-screen w-screen overflow-hidden text-slate-800 flex flex-col overscroll-none">

   <div class="flex-none p-4 z-50 pointer-events-none w-full">
      <div
         class="max-w-4xl mx-auto bg-green-400 border-4 border-green-600 rounded-full px-4 py-2 shadow-xl flex items-center justify-between pointer-events-auto transform hover:scale-[1.01] transition-transform">
         <div class="flex items-center gap-3">
            <span class="text-2xl animate-bounce">ü•≠</span>
            <span id="info-text" class="text-lg font-bold text-green-900 leading-none mt-1">Operasi Tolak (Situasi
               Harian)</span>
         </div>
         <button id="speak-btn" onclick="speakInfo()"
            class="bg-white hover:bg-green-50 text-green-600 border-2 border-green-200 rounded-full p-2 transition-colors shadow-sm">üîä</button>
      </div>
   </div>

   <div class="flex-1 w-full max-w-5xl mx-auto p-2 flex flex-col min-h-0">

      <div class="game-card p-4 mb-2 flex-1 w-full">
         <div id="activity-content"
            class="w-full relative z-10 flex flex-col items-center justify-center h-full transition-opacity duration-200">
            <div class="py-10 text-center">
               <div class="text-8xl mb-6 animate-pulse">üìñ</div>
               <h2 class="text-4xl md:text-5xl font-bold text-emerald-600 mb-4">Situasi Harian</h2>
               <p class="text-lg text-slate-500 mb-8 font-semibold">Fahamkan konsep tolak melalui cerita.</p>
               <div class="text-4xl animate-bounce">üëá</div>
            </div>
         </div>
      </div>

      <div class="flex-none bg-white/80 backdrop-blur-sm rounded-3xl shadow-lg p-2 border-2 border-white">
         <h3 class="text-lg font-bold text-slate-700 mb-1 text-center">üéÆ Pilih Aktiviti</h3>

         <div class="grid grid-cols-5 gap-2 mb-2">
            <button onclick="loadActivity(1)"
               class="btn-3d bg-blue-500 text-white font-bold py-2 rounded-xl text-xs">üéØ<br>Faham</button>
            <button onclick="loadActivity(2)"
               class="btn-3d bg-green-500 text-white font-bold py-2 rounded-xl text-xs">üçé<br>Mudah</button>
            <button onclick="loadActivity(3)"
               class="btn-3d bg-purple-500 text-white font-bold py-2 rounded-xl text-xs">ü•≠<br>Pinjam</button>
            <button onclick="loadActivity(4)"
               class="btn-3d bg-orange-500 text-white font-bold py-2 rounded-xl text-xs">üîó<br>Abstrak</button>
            <button onclick="loadActivity(5)"
               class="btn-3d bg-rose-500 text-white font-bold py-2 rounded-xl text-xs">‚úçÔ∏è<br>Bina</button>
         </div>

         <div class="flex justify-center gap-4 border-t-2 border-slate-100 pt-2">
            <button onclick="clearActivity()"
               class="btn-3d bg-slate-400 text-white font-bold py-1 px-4 rounded-full text-base">üè† Menu</button>
            <button onclick="nextActivity()"
               class="btn-3d bg-indigo-500 text-white font-bold py-1 px-6 rounded-full text-lg">Seterusnya ‚û°Ô∏è</button>
         </div>
      </div>
   </div>

   <script>
      /* --- STANDARD HELPERS --- */
      let currentActivity = 0;
      let ttsEnabled = false;
      let currentInfo = "Pilih aktiviti untuk mula!";
      let draggedElement = null;

      // State Global
      window.subtractionGames = {
         activity2: { count: 0, target: 3 },
         activity3: { count: 0, target: 15, bundles: 2 }
      };

      function triggerWin() { confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 } }); }

      function speak(text) {
         if (!ttsEnabled || !('speechSynthesis' in window)) return;
         window.speechSynthesis.cancel();
         const u = new SpeechSynthesisUtterance(text); u.lang = 'ms-MY'; u.rate = 0.95; u.pitch = 1.05;
         const ms = window.speechSynthesis.getVoices().find(v => v.lang === 'ms-MY' || v.lang?.startsWith('ms'));
         if (ms) u.voice = ms;
         window.speechSynthesis.speak(u);
      }

      function setInfo(text) {
         currentInfo = text; const infoEl = document.getElementById('info-text');
         infoEl.style.opacity = 0; setTimeout(() => { infoEl.textContent = text; infoEl.style.opacity = 1; }, 200);
      }

      function speakInfo() {
         if (!ttsEnabled) { ttsEnabled = true; document.getElementById('speak-btn').classList.add('bg-green-100', 'text-green-600'); }
         speak(currentInfo);
      }

      /* --- DRAG & DROP LOGIC --- */
      window.dragStart = function (e) { draggedElement = e.target; e.target.classList.add('dragging'); }
      window.dragEnd = function (e) { if (draggedElement) draggedElement.classList.remove('dragging'); document.querySelectorAll('.drop-zone').forEach(z => z.classList.remove('drag-over')); }
      window.allowDrop = function (e) { e.preventDefault(); if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.add('drag-over'); }
      window.dragLeave = function (e) { if (e.currentTarget.classList.contains('drop-zone')) e.currentTarget.classList.remove('drag-over'); }

      /* --- ROUTER --- */
      function loadActivity(n) {
         currentActivity = n;
         const content = document.getElementById('activity-content');
         content.style.opacity = 0;
         setTimeout(() => {
            if (n === 1) loadStoryComprehension(content);
            if (n === 2) loadSimpleSubtraction(content);
            if (n === 3) loadRegroupSubtraction(content);
            if (n === 4) loadAbstractLink(content);
            if (n === 5) loadStoryBuilder(content);
            content.style.opacity = 1;
         }, 200);
      }

      function clearActivity() {
         currentActivity = 0;
         document.getElementById('activity-content').innerHTML = `<div class="py-10 text-center"><div class="text-8xl mb-6 animate-pulse">üìñ</div><h2 class="text-5xl font-bold text-emerald-600 mb-4">Situasi Harian</h2><p class="text-2xl text-slate-500 mb-8 font-semibold">Operasi Tolak dalam Kehidupan Sebenar</p></div>`;
         setInfo("Pilih aktiviti untuk mula!");
      }
      function nextActivity() { let next = currentActivity + 1; if (next > 5) next = 1; loadActivity(next); }


      /* =========================================
         LOGIK AKTIVITI
         ========================================= */

      /* 1. Fahamkan Cerita */
      function loadStoryComprehension(content) {
         setInfo("Baca cerita. Seret nombor ke kotak yang betul.");
         content.innerHTML = `
        <div class="w-full max-w-4xl text-center flex flex-col h-full overflow-hidden">
            <h3 class="text-xl font-bold text-blue-500 mb-2 flex-none">üéØ Fahamkan Cerita</h3>
            <div class="bg-blue-50 border-2 border-blue-200 rounded-2xl p-4 flex-1 flex flex-col min-h-0 w-full overflow-y-auto">
               <p class="text-base text-slate-700 leading-normal mb-4 text-center flex-none">
                  "Di atas pokok mangga ada <strong class="text-blue-600">24</strong> biji buah. 
                  <strong class="text-rose-500">15</strong> biji masih hijau. Berapa yang masak?"
               </p>
               
               <div class="flex justify-center gap-4 mb-4 flex-none">
                  <div class="btn-3d bg-white border-blue-300 text-blue-800 rounded-xl p-2 text-xl font-bold draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="24">24</div>
                  <div class="btn-3d bg-white border-blue-300 text-blue-800 rounded-xl p-2 text-xl font-bold draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="15">15</div>
                  <div class="btn-3d bg-white border-blue-300 text-blue-800 rounded-xl p-2 text-xl font-bold draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-number="9">9</div>
               </div>
    
               <div class="grid grid-cols-3 gap-2 flex-1">
                  <div class="bg-white p-2 rounded-xl border-2 border-slate-100 text-center flex flex-col items-center">
                     <div class="text-xs font-bold text-slate-400 uppercase mb-1">Jumlah Semua</div>
                     <div class="drop-zone w-full h-16 text-2xl" ondrop="dropOnStoryBox(event, '24')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">...</div>
                  </div>
                  <div class="bg-white p-2 rounded-xl border-2 border-slate-100 text-center flex flex-col items-center">
                     <div class="text-xs font-bold text-slate-400 uppercase mb-1">Mangga Hijau</div>
                     <div class="drop-zone w-full h-16 text-2xl" ondrop="dropOnStoryBox(event, '15')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">...</div>
                  </div>
                  <div class="bg-white p-2 rounded-xl border-2 border-slate-100 text-center flex flex-col items-center">
                     <div class="text-xs font-bold text-slate-400 uppercase mb-1">Mangga Masak</div>
                     <div class="drop-zone w-full h-16 text-2xl" ondrop="dropOnStoryBox(event, '9')" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">...</div>
                  </div>
               </div>
            </div>
        </div>`;
      }
      window.dropOnStoryBox = function (e, correct) {
         e.preventDefault(); e.currentTarget.classList.remove('drag-over'); if (!draggedElement) return;
         const val = draggedElement.dataset.number;
         if (val === correct) {
            e.currentTarget.textContent = val; e.currentTarget.classList.add('filled');
            draggedElement.remove(); draggedElement = null;
            speak("Betul!");
            if (document.querySelectorAll('.drop-zone:not(.filled)').length === 0) { setInfo("Syabas! Anda faham cerita ini."); triggerWin(); }
         } else {
            e.currentTarget.classList.add('shake'); setTimeout(() => e.currentTarget.classList.remove('shake'), 400);
            speak("Cuba lagi.");
         }
      }

      /* 2. Tolak Mudah */
      function loadSimpleSubtraction(content) {
         setInfo("Seret 3 biji epal ke dalam bakul.");
         window.subtractionGames.activity2 = { count: 0, target: 3 };

         content.innerHTML = `
        <div class="w-full max-w-3xl text-center flex flex-col h-full overflow-hidden">
            <h3 class="text-xl font-bold text-green-500 mb-2 flex-none">üçé Tolak Mudah: 24 - 3</h3>
            <div class="flex flex-col items-center flex-1 min-h-0 w-full overflow-y-auto">
               <div class="bg-gray-100 p-2 rounded-2xl mb-4 flex flex-wrap gap-2 justify-center items-end min-h-[80px] w-full max-w-2xl flex-none">
                  <div class="obj-bundle">10</div><div class="obj-bundle">10</div>
                  <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                  <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                  <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                  <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
               </div>
               
               <div class="drop-zone w-36 h-36 rounded-full border-4 border-green-300 flex flex-wrap justify-center items-center p-2 flex-none" 
                    id="basket-zone" ondrop="dropOnBasket(event, 2)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <span class="text-green-300 font-bold text-lg pointer-events-none">BAKUL</span>
               </div>
            </div>
        </div>`;
      }

      /* 3. Tolak Pinjam */
      function loadRegroupSubtraction(content) {
         setInfo("Tolak 24 - 15. Pecahkan ikatan 10 jika perlu.");
         window.subtractionGames.activity3 = { count: 0, target: 15, bundles: 2 };

         content.innerHTML = `
        <div class="w-full max-w-3xl text-center flex flex-col h-full overflow-hidden">
            <h3 class="text-xl font-bold text-purple-500 mb-2 flex-none">ü•≠ Tolak Pinjam: 24 - 15</h3>
            <div class="flex flex-col items-center flex-1 min-h-0 w-full overflow-y-auto">
               <div id="obj-container" class="bg-gray-100 p-2 rounded-2xl mb-4 flex flex-wrap gap-2 justify-center items-end min-h-[80px] w-full max-w-2xl flex-none">
                  <div class="obj-bundle" onclick="pecahIkatan(this)">10</div>
                  <div class="obj-bundle" onclick="pecahIkatan(this)">10</div>
                  <div id="sa-container" class="flex gap-1 flex-wrap justify-center">
                     <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                     <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                     <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                     <div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>
                  </div>
               </div>
               
               <div class="drop-zone w-36 h-36 rounded-full border-4 border-purple-300 flex flex-wrap justify-center items-center p-2 flex-none" 
                    id="basket-zone" ondrop="dropOnBasket(event, 3)" ondragover="allowDrop(event)" ondragleave="dragLeave(event)">
                    <span class="text-purple-300 font-bold text-lg pointer-events-none">BAKUL</span>
               </div>
            </div>
        </div>`;
      }

      window.pecahIkatan = function (el) {
         let state = window.subtractionGames.activity3;
         if (state.count >= state.target) return;

         // Check if singles still exist
         if (document.querySelectorAll('#sa-container .obj-single').length > 0) {
            speak("Guna sa dahulu."); el.classList.add('shake'); setTimeout(() => el.classList.remove('shake'), 500); return;
         }

         el.remove(); state.bundles--;
         const container = document.getElementById('sa-container');
         for (let i = 0; i < 10; i++) container.innerHTML += `<div class="obj-single draggable-item" draggable="true" ondragstart="dragStart(event)" ondragend="dragEnd(event)" data-type="sa">1</div>`;
         speak("Ikatan dipecahkan menjadi 10 sa.");
      }

      window.dropOnBasket = function (e, actNum) {
         e.preventDefault(); e.currentTarget.classList.remove('drag-over');
         let state = window.subtractionGames['activity' + actNum];

         if (state.count >= state.target) { speak("Bakul dah penuh."); return; }
         if (!draggedElement || draggedElement.dataset.type !== 'sa') return;

         state.count++;
         draggedElement.remove(); draggedElement = null;
         const ball = document.createElement('div'); ball.className = 'obj-single'; ball.innerText = '1';
         e.currentTarget.appendChild(ball);

         if (state.count === state.target) {
            triggerWin(); speak("Syabas! Baki dikira dengan betul.");
         } else {
            speak(state.count.toString());
         }
      }

      /* 4. Konkrit ke Abstrak */
      function loadAbstractLink(content) {
         setInfo("Lihat kaitan visual dan nombor.");
         content.innerHTML = `
        <div class="w-full max-w-4xl text-center flex flex-col h-full overflow-hidden">
            <h3 class="text-xl font-bold text-orange-500 mb-2 flex-none">üîó Konkrit ke Abstrak</h3>
            <div class="flex-1 flex flex-col md:flex-row gap-4 max-w-4xl mx-auto items-center min-h-0 w-full overflow-y-auto">
               <div class="text-center bg-orange-50 p-2 rounded-2xl border-2 border-orange-100 flex-1">
                  <h4 class="text-sm font-bold text-slate-500 mb-2 uppercase">Visual</h4>
                  <div id="abs-model" class="flex flex-wrap gap-1 justify-center">
                     <div class="obj-bundle">10</div><div class="obj-bundle">10</div>
                     <div class="obj-single">1</div><div class="obj-single">1</div><div class="obj-single">1</div><div class="obj-single">1</div>
                  </div>
               </div>
               <div class="text-center bg-white p-2 rounded-2xl border-2 border-slate-200 flex-1">
                  <h4 class="text-sm font-bold text-slate-500 mb-2 uppercase">Bentuk Lazim</h4>
                  <table class="lazim-table">
                     <tr><td class="col-pu text-slate-400 text-sm uppercase">Pu</td><td class="text-slate-400 text-sm uppercase">Sa</td></tr>
                     <tr id="row-1"><td class="col-pu">2</td><td>4</td></tr>
                     <tr class="row-line text-slate-500"><td class="col-pu">- 1</td><td>5</td></tr>
                     <tr class="text-orange-600"><td class="col-pu" id="ans-pu">?</td><td id="ans-sa">?</td></tr>
                  </table>
               </div>
            </div>
            <div class="text-center mt-2 flex-none pb-2">
               <button id="btn-step1" class="btn-3d bg-orange-500 text-white font-bold py-2 px-4 rounded-xl text-base" onclick="runAbsStep(1)">Langkah 1: Pinjam ‚ÜòÔ∏è</button>
               <button id="btn-step2" class="btn-3d bg-slate-300 text-white font-bold py-2 px-4 rounded-xl text-base" onclick="runAbsStep(2)" disabled>Langkah 2: Selesai ‚úÖ</button>
            </div>
        </div>`;
      }
      window.runAbsStep = function (step) {
         if (step === 1) {
            document.getElementById('abs-model').innerHTML = `<div class="obj-bundle">10</div><div class="obj-bundle opacity-50">10</div>` + `<div class="obj-single">1</div>`.repeat(14);
            const r1 = document.getElementById('row-1');
            r1.children[0].innerHTML = `<span class="borrow-new">1</span><span class="strike">2</span>`;
            r1.children[1].innerHTML = `<span class="borrow-new">14</span><span class="strike">4</span>`;
            speak("Pecah ikatan sama dengan pinjam 1 puluh.");
            document.getElementById('btn-step1').disabled = true; document.getElementById('btn-step1').className = "btn-3d bg-slate-300 text-white font-bold py-3 px-8 rounded-xl text-lg";
            document.getElementById('btn-step2').disabled = false; document.getElementById('btn-step2').className = "btn-3d bg-orange-500 text-white font-bold py-3 px-8 rounded-xl text-lg";
         }
         if (step === 2) {
            document.getElementById('ans-pu').textContent = "0"; document.getElementById('ans-sa').textContent = "9";
            speak("Jawapan ialah 9."); triggerWin();
            document.getElementById('btn-step2').disabled = true;
         }
      }

      /* 5. Bina Cerita */
      function loadStoryBuilder(content) {
         setInfo("Masukkan nombor dan lihat penyelesaiannya.");
         content.innerHTML = `
        <div class="w-full max-w-2xl text-center flex flex-col h-full overflow-hidden">
            <h3 class="text-xl font-bold text-rose-500 mb-2 flex-none">‚úçÔ∏è Bina Cerita Sendiri</h3>
            <div class="bg-white border-2 border-rose-200 rounded-2xl p-4 flex-1 flex flex-col items-center justify-start min-h-0 w-full overflow-y-auto">
               <p class="text-lg font-medium text-slate-700 mb-4 leading-loose flex-none">
                  Saya ada <input type="number" id="n1" class="border-2 border-rose-300 rounded-lg w-16 text-center font-bold text-rose-600 mx-2 p-1" value="32"> biji epal. <br>
                  Saya beri <input type="number" id="n2" class="border-2 border-rose-300 rounded-lg w-16 text-center font-bold text-rose-600 mx-2 p-1" value="15"> biji.
               </p>
               <button class="btn-3d bg-rose-500 text-white font-bold py-2 px-6 rounded-xl text-lg w-full max-w-xs flex-none" onclick="solveStory()">Kira Bakinya üßÆ</button>
               
               <div id="story-res" class="mt-4 hidden flex-none w-full">
                  <table class="lazim-table mx-auto bg-rose-50 p-2 rounded-xl border border-rose-100 w-3/4">
                     <tr class="text-slate-400 text-sm uppercase"><td>Pu</td><td>Sa</td></tr>
                     <tr id="s-row1"><td></td><td></td></tr>
                     <tr class="row-line text-slate-600" id="s-row2"><td></td><td></td></tr>
                     <tr class="text-rose-600 font-black" id="s-row3"><td></td><td></td></tr>
                  </table>
                  <p class="mt-2 text-lg font-bold text-green-600" id="s-msg"></p>
               </div>
            </div>
        </div>`;
      }
      window.solveStory = function () {
         const n1 = parseInt(document.getElementById('n1').value);
         const n2 = parseInt(document.getElementById('n2').value);
         if (isNaN(n1) || isNaN(n2) || n1 <= n2) { speak("Nombor tidak sah."); return; }

         const ans = n1 - n2;
         const p1 = Math.floor(n1 / 10), s1 = n1 % 10;
         const p2 = Math.floor(n2 / 10), s2 = n2 % 10;
         const pa = Math.floor(ans / 10), sa = ans % 10;

         document.getElementById('story-res').classList.remove('hidden');
         const r1 = document.getElementById('s-row1');

         if (s1 < s2) {
            r1.children[0].innerHTML = `<span class="borrow-new">${p1 - 1}</span><span class="strike">${p1}</span>`;
            r1.children[1].innerHTML = `<span class="borrow-new">${s1 + 10}</span><span class="strike">${s1}</span>`;
            speak("Perlu pinjam sebab sa tak cukup.");
         } else {
            r1.children[0].textContent = p1; r1.children[1].textContent = s1;
            speak("Tolak terus tanpa pinjam.");
         }

         document.getElementById('s-row2').innerHTML = `<td class="col-pu">- ${p2}</td><td>${s2}</td>`;
         document.getElementById('s-row3').innerHTML = `<td class="col-pu">${pa}</td><td>${sa}</td>`;
         document.getElementById('s-msg').textContent = `Jawapan: ${ans} biji epal.`;
         triggerWin();
      }

   </script>
</body>

</html>